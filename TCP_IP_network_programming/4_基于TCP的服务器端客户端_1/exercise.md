## 1. 请说明 TCP/IP 的4层协议栈，并说明 TCP 和 UDP 套接字经过的层级结构差异？

TCP/IP 协议栈，也叫作网络模型，是一个由四层协议组成的系统，这些协议定义了数据从源发送到目的地的路由方式。这四层，从底层到上层分别是：

网络接口层：这一层也被称为网络访问层或者物理层，负责处理数据在物理网络间的传输。比如以太网、Wi-Fi 等都在这一层。

网络层：主要负责数据包的发送和接收，包括路由选择、包转发等。这一层的核心协议是网络协议 IP (Internet Protocol) 。

传输层：提供端到端的数据传输服务，这一层的主要协议有 TCP (Transmission Control Protocol，传输控制协议) 和 UDP (User Datagram Protocol，用户数据报协议)。

应用层: 这一层提供给网络应用的接口，比如 HTTP、SMTP 等都在这一层。

TCP 套接字和 UDP 套接字经历的层级结构基本相同，它们都会依次经过应用层，传输层，网络层，到达网络接口层，然后在接收端反向经过这些层级。区别在于在传输层，TCP和UDP具有不同的特性：

TCP 提供的是面向连接的、可靠的字节流服务，它在传输数据之前，需要先建立连接，然后才能开始数据传输; 数据传输完成后，还需要释放已有的连接。在整个传输过程中，TCP 会实时进行错误检查并请求重传，以保证数据包的顺序和不丢失。

与 TCP 不同，UDP 是一种无连接的服务，发送数据之前不需要建立连接，在传输数据时，也不进行错误检查和重传，它只是把应用程序传给 IP 层的数据报发送出去，但是能否到达目标并不关心。因此，UDP 速度较快，但不可靠。好处是，当我们不需要或不能使用 TCP 时，它是一个非常好的替代选择。

## 2. 请说出 TCP/IP 协议栈中链路层和 IP 层的作用，并给出两者关系？

链路层（Link Layer）又称为网络接口层，是 TCP/IP 协议栈最底层的一个层次。链路层的主要作用是定义了如何在网络媒介（比如以太网、WiFi）上物理传输数据，包括如何封装数据帧、如何处理传输错误、进行流量控制等等。链路层把 IP 层传下来的 IP 数据报封装进数据帧，通过物理媒介（电缆、无线电波等）发送出去。

IP层（或称网络层）位于链路层之上，它的主要职责是确定如何通过网络从源到目的地路由 IP 数据报。这涉及到地址、路由等概念。值得注意的是，IP 层不关心数据到达的具体路径，或者说数据经过了哪些具体的物理或者网络链路，只关心如何寻找到达目标的路径。

链路层和 IP 层之间的关系非常紧密，可以理解为，链路层为 IP 层提供了服务：IP 层生成 IP 数据报后，交给链路层，由链路层负责真正的数据传输；当链路层接收到数据后，会拆开数据帧，把里面的 IP 数据报交给 IP 层。这两者之间的关系也展现了 TCP/IP 协议栈的分层设计原理，每一层都只需要和自己相邻的层进行交互，为上一层提供服务，使用下一层的服务，大大简化了网络通讯的复杂性。

## 3. 为何需要把 TCP/IP 协议分成4层（7层）？结合开放式系统回答？

将 TCP/IP 协议分层的主要目的是为了降低编程、开发和维护的复杂性，每一层只专注于提供特定的服务，不需要了解整个协议栈的所有细节。每一层可以独立进行改变，只要保持与相邻层的接口不变，就不会影响整个系统的运行。

这种设计模式与开放式系统的设计原则是一致的。开放式系统是一个由若干个模块或组件构成的系统，各模块之间通过定义好的接口进行通信。通过这种方式，每个模块可以自由增删或者替换，而不会影响其他模块的运行，从而提高了系统的灵活性和扩展性。

例如，对于 TCP/IP 协议栈，如果我们要替换底层的物理网络设备，比如从有线网络替换为 Wi-Fi 无线网络，只需要更改网络接口层的实现，与网络接口层相邻的网络层不需要作任何改变。

同样，如果我们想要在应用层引入一种新的应用协议，我们只需要编写新的应用层软件即可，而不需要更改其他层的软件。

所以，分层的设计可以提高整个系统的可靠性和灵活性，这就是为什么需要将 TCP/IP 协议分层的主要原因。
	
## 4. 客户端调用 connect 函数向服务器发送连接请求，服务器调用哪个函数后，客户端可以调用 connect 函数？

服务器在客户端可以调用 connect 函数之前，首先需要调用 socket 函数创建一个套接字，然后调用 bind 函数将套接字与服务器的地址（包括 IP 地址和端口号）绑定，最后通过调用 listen 函数开启监听。

在调用 listen 函数后，服务器开始接受客户端的连接请求。当客户端调用 connect 函数后，服务器可以通过调用 accept 函数，接受这个连接请求，然后与客户端建立连接并开始数据通信。所以答案是 listen 函数。
	
## 5. 什么时候创建连接请求等待队列？它有什么作用？与 accept 有什么关系？

连接请求等待队列会在服务器调用 listen 函数时创建。该队列的主要作用是缓存来自客户端的连接请求。当一个客户端调用 connect 发起连接请求后，如果服务器当前正在处理其他请求并且无法立刻处理新的连接请求，这个请求就会被放入等待队列中，等待服务器空闲时处理。

这样做的好处是，可以使服务器在高并发的环境下，有能力处理大量的并发连接请求，同时也避免了请求因为服务器瞬间的处理能力达不到而被忽略或者丢弃。
与 accept 函数的关系是，当服务器调用 accept 函数后，它会从连接请求等待队列中取出一个连接请求（如果队列中有的话）并处理，处理完该请求后创建一个新的套接字，然后与请求的客户端建立连接。如果队列中没有连接请求，则 accept 函数会阻塞，直到有新的连接请求到达。

## 6. 客户端中为何不需要调用 bind 函数分配地址？如果不调用 bind 函数，那什么时间，如何向套接字分配 IP 地址和端口号？

在 TCP/IP 网络编程中，客户端通常不需要显式地调用 bind 函数分配地址，主要原因是客户端的端口号通常不需要固定，而是由操作系统在进行 connect 函数调用时动态分配。这样做的便利性在于，应用程序无需操心端口分配，更无需担心端口冲突问题。

当客户端调用 connect 函数时，如果该套接字还没绑定地址（IP 地址和端口号），系统会自动为其分配一个临时的、可用的端口号，以及当前网络接口的 IP 地址。这个过程被称为隐式绑定。

也就是说，对于客户端应用程序来说，只有在特殊情况下（例如：需要使用特定的客户端 IP 或端口进行连接）才需要显示地调用 bind 函数分配地址。在大多数使用场景中，客户端应用程序只需调用 connect 即可。
	
## 7. 把`hello_server.c`和 `hello_win.c`，修改为迭代服务器端，利用客户端测试更改是否正确？

