## 1. 请说明 TCP 套接字连接设置三次握手过程，尤其是3次交换过程每次收发的数据内容

TCP 套接字连接设置的三次握手过程如下：

第一次握手：客户端向服务器发送连接请求报文段。这个报文段中包含自己的数据通信初始序列号。报文的同步(SYN)标志位设为1，初始化序列号设为 x（随机数）；即 SYN=1, seq=x。

第二次握手：服务器收到客户端的 SYN 报文段应答（确认）。同时，向客户端发送 SYN=1, ACK=1, 确认号 ack=x + 1，初始化序列号 seq=y（随机数），即向客户端发送 SYN+ACK 报文。此步在服务器端完成，表示服务器已经准备好接受客户端发送的数据。

第三次握手：客户端收到服务器的 SYN+ACK 报文后，还要向服务器给出确认。ACK=1,确认号 ack=y + 1，序列号 seq=x + 1。此包发送完毕，客户端进入 ESTABLISHED 状态，完成三次握手。当服务器收到这个包时，也进入 ESTABLISHED 状态，完成三次握手。

三次握手完成后，客户端和服务器就可以开始发送数据了。三次握手主要是为了防止已失效的连接请求报文突然又传送到服务器，因而产生错误。

## 2. TCP 是可靠的数据传输协议，但是通过网络通信的过程中可能丢失数据，请通过 ACK 和 SEQ 说明，TCP 通过何种机制保证丢失数据的可靠传输？

TCP 通过使用数据包的序列号（SEQ）和确认号（ACK）以及重传机制来保证丢失数据的可靠传输。

序列号（SEQ）：发送方给每个发送的数据包一个唯一的序列号，接收方通过返回这个序列号来确认已经接收到这个包。如果发送方没有收到确认，就知道数据包可能已经丢失，并且需要重传。

确认号（ACK）：当接收端收到数据包后，它会发送一个 ACK，它的值是接收方期望接收到的下一个包的序列号，也就是上一次接收到的包的序列号 +1。也可以理解为，接收方已经成功接收到此序列号之前的所有数据。

重传机制：TCP 设置了一个超时时间，如果在这个时间内没收到 ACK，就会重传这个数据包。此外，TCP 还引入了快速重传机制，就是当接收端连续接收到3个相同，且乱序的包时，会立即发送重传请求，而不必等待超时。

因此，结合这些机制，TCP 协议可以保证在网络通信中丢失数据的情况下，依然能够保证数据的可靠传输。

 
## 3. TCP 套接字中调用 write 和 read 函数时候，数据如何移动？结合 I/O 缓冲进行说明？

在 TCP 套接字中，数据的移动主要依赖于 I/O 缓冲区。每个 TCP 套接字都有一个输入缓冲区和一个输出缓冲区，这两个缓冲区都是在创建套接字时动态生成的。

write 函数调用：应用程序调用 write 函数将数据写入到输出缓冲区，write 函数返回后，并不代表数据已经被发送，实际上，数据是被存储在套接字的发送缓冲区中，然后由 TCP 协议根据网络状况，决定何时真正发送这些数据。如果输出缓冲区满了，write 函数就会阻塞，直到缓冲区中有足够的空间可用。
read 函数调用：相对应的，当接收端的 TCP 协议收到数据后，它会将这些数据存储到套接字的接收缓冲区中。应用程序在适合的时候调用 read 函数从输入缓冲区中读取数据。如果缓冲区为空，那么 read 函数会阻塞，直到收到新的数据。

结合 I/O 缓冲进行数据移动的好处在于，它使得网络 I/O 可以在用户空间和内核空间之间缓冲数据，这样，即使应用程序暂时不处理数据，TCP 协议也可以继续进行数据的发送和接收，提高了数据传输的效率。

## 4. 对方主机的输入缓冲剩余 50 字节空间时候，若本主机通过 write 函数请求传输 70 字节，请问 TCP 如何处理这种情况？

当对方主机的输入缓冲只剩下50字节的空间，而本主机通过 write 函数请求传输70字节时，TCP 将通过“滑动窗口”和“流量控制”机制来处理这种情况。

滑动窗口机制使得每个发送的 TCP 数据包都有一个序列号，同时接收端会返回一个被称为”窗口”的值，表示可接收的字节数。如果窗口值为50，那么发送方只能发送50字节的数据，即使发送方有更多的数据要发送。

在这种情况下，发送方（本主机）首先会发送50字节的数据，然后等待接收方（对方主机）处理这些数据并释放缓冲区。一旦接收方处理了一些数据并释放了缓冲区，它会更新窗口值并将这个值返回给发送方。发送方收到新的窗口值后，会继续发送剩余的数据。

如果接收方的窗口值达到0，那么发送方会停止发送数据，等待接收方更新窗口值。这就是TCP的流量控制机制，它可以防止发送方发送过多的数据导致接收方的缓冲区溢出。

## 6. 创建收发文件的服务器端/客户端，实现顺序如下。

1. 客户端接受用户输人的传输文件名。

1. 客户端请求服务器端传输该文件名所指文件。

1. 如果指定文件存在，服务器端就将其发送给客户端:反之，则断开连接
